package csc212project11;

import java.time.LocalDate;
import java.util.Scanner;


public class Store {
	
	private static LinkedList<Customer> customers_list;
	private static LinkedList<Order> orders_list;
	private static LinkedList<Product> products_list;
	private static LinkedList<Review> reviews_list;
	
	private static Reviews all_Reviews;
	private static Customers all_Customers;
	private static Orders all_Orders;
	private static Products all_Products;
	
	public Store() {
		
		customers_list= new LinkedList<Customer>();
		orders_list= new LinkedList<Order>();
		products_list= new LinkedList<Product>();
		reviews_list= new LinkedList<Review>();
		
		
		all_Products= new Products(products_list);
		all_Reviews= new Reviews(reviews_list,products_list,customers_list);
		all_Customers= new Customers(customers_list);
		all_Orders=new Orders(customers_list,orders_list);	
	}
	
	public static void Load_all() {
		all_Products.load_products("C:\\Users\\sondo\\eclipse-workspace\\csc212project11\\products.csv");
	    all_Customers.loadCustomers("C:\\Users\\sondo\\eclipse-workspace\\csc212project11\\customers.csv");
	    all_Orders.loadOrders("C:\\Users\\sondo\\eclipse-workspace\\csc212project11\\orders.csv");
	    all_Reviews.load_revews("C:\\Users\\sondo\\eclipse-workspace\\csc212project11\\reviews.csv");
	}

	public static void add_Customer(Customer c) {
	    if (all_Customers != null)
	        all_Customers.addCustomer(c);
	    else
	        System.out.println("Error: Customer list not initialized!");
	}

	public static void add_Product(Product p) {
	    if (all_Products != null)
	    	all_Products.addProduct(p);
	    else
	        System.out.println(" Error: Product list not initialized!");
	}

	public static void add_Order(Order o) {
	    if (all_Orders != null)
	        all_Orders.addOrder(o);
	    else
	        System.out.println("Error: Orders list not initialized!");
	}

	public static void add_Review(Review r) {
	    all_Reviews.addReview(r);
	}

	public void displayTop3Products() {
	    if (products_list.empty()) {
	        System.out.println("No products available.");
	        return;
	    }
	    
	    Product max1 = new Product(-1, "no product", -1, -1);
	    Product max2 = new Product(-1, "no product", -1, -1);
	    Product max3 = new Product(-1, "no product", -1, -1);

	    products_list.findFirst();
	    while (true) {
	        Product cur = products_list.retrieve();

	        if (cur.getAverageRating() > max1.getAverageRating()) {
	            max3 = max2;
	            max2 = max1;
	            max1 = cur;
	        } else if (cur.getAverageRating() > max2.getAverageRating()) {
	            max3 = max2;
	            max2 = cur;
	        } else if (cur.getAverageRating() > max3.getAverageRating()) {
	            max3 = cur;
	        }

	        if (products_list.last()) break;
	        products_list.findNext();
	    }

	    System.out.println("\nâ˜… Top Products by Average Rating:");

	    int rank = 1;
	    if (max1 != null) {
	        System.out.println(rank++ + ". Product ID: " + max1.getProductId()
	            + " | Name:" + max1.getName()
	            + " | Avg Rating: " + String.format("%.2f", max1.getAverageRating()));
	    }

	    if (max2 != null) {
	        System.out.println(rank++ + ". Product ID: " + max2.getProductId()
	            + " | Name:" + max2.getName()
	            + " | Avg Rating: " + String.format("%.2f", max2.getAverageRating()));
	    }

	    if (max3 != null) {
	        System.out.println(rank++ + ". Product ID: " + max3.getProductId()
	            + " | Name:" + max3.getName()
	            + " | Avg Rating: " + String.format("%.2f", max3.getAverageRating()));
	    }

	    System.out.println("------------------------------");
	
	    

	    LinkedList<Product> tempList = new LinkedList<>();
	    products_list.findFirst();
	    int count = 0; 
	    while (true) {
	        tempList.addLast(products_list.retrieve());
	        count++;
	        if (products_list.last()) break;
	        products_list.findNext();
	    }
	    LinkedList<Product> topList = new LinkedList<>();
	    int needed = Math.min(3, count);
	    for (int k = 0; k < needed; k++) {
	        if (tempList.empty()) break;
	        tempList.findFirst();
	        Product maxProd = tempList.retrieve();
	        while (true) {
	            Product cur = tempList.retrieve();
	            if (cur.getAverageRating() > maxProd.getAverageRating()) {
	                maxProd = cur;
	            }
	            if (tempList.last()) break;
	            tempList.findNext();
	        }

	        tempList.findFirst();
	        while (true) {
	            if (tempList.retrieve() == maxProd) {
	                tempList.remove();
	                break;
	            }
	            if (tempList.last()) break;
	            tempList.findNext();
	        }

	        topList.addLast(maxProd);
	    }
	}
	

	public void showCommonHighRatedProducts2(int c1, int c2) {
		LinkedList<Product> allProducts= all_Products.get_Products();
		if(allProducts.empty()) {
			System.out.println("NO PRODUCTS FOUND!");
			return;
		}
		System.out.println("===COMMON HIGH RATED PRODUTS (>4)=====");
		
		boolean anyfound=false;
		allProducts.findFirst();
		while(true) {
			Product p= allProducts.retrieve();
			int pid= p.getProductId();
			
			if(p.getAverageRating()>4) {
				boolean found1=false;
				boolean found2=false;
				
				if(!reviews_list.empty()) {
					reviews_list.findFirst();
					while(true){
						Review r= reviews_list.retrieve();
						
						if(r.getProductId()==pid) {
							if(r.getCustomerId()==c1)found1=true;
							if(r.getCustomerId()==c2)found2=true;			
						}
						
						if(reviews_list.last())break;
						reviews_list.findNext();
					}
				}
				
				if(found1&&found2) {}
				System.out.println("PRODUCT: "+p.getName()+
						"| ID: "+pid+
						"| AVERAGE RATING: "+p.getAverageRating());
				anyfound=true;

			}
		}
		if(!anyfound)
			System.out.println(" NO COMMON HIGH-RATED PRODUCTS FOUND");
		
	}
	
	

	
	

	public static void main(String[] args) {
		
		Store s= new Store();
		Scanner input= new Scanner(System.in);
		int choice=0;
		do {
			System.out.println("==================WELCOME TO OUR STORE===================");

			System.out.println("1.Read data from file.");
			System.out.println("2.Add product.");
			System.out.println("3.Add a customer.");
			System.out.println("4.Add an order.");
			System.out.println("5.Add a review.");
			System.out.println("6.------");
			System.out.println("7.Top 3 products by average rating.");
			System.out.println("8.All orders between two dates.");
			System.out.println("9.Common high rated products.");
			System.out.print("Enter your choice");
			
			choice=input.nextInt();
			

			switch(choice) {
			case 1:
				Load_all();
				break;
			case 2: 
				Product p=new Product(input.nextInt(),input.nextLine(),input.nextDouble(), input.nextInt());
				add_Product(p);
				break;
				
			case 3:
			case 4:
			case 5:
				
			
			
			}






			
		}while(choice!=0);
		
		
		

	}

}
