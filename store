package csc212project11;

import java.time.LocalDate;
import java.util.Scanner;


public class Store {
	
	private static LinkedList<Customer> customers_list;
	private static LinkedList<Order> orders_list;
	private static LinkedList<Product> products_list;
	private static LinkedList<Review> reviews_list;
	
	private static Reviews all_Reviews;
	private static Customers all_Customers;
	private static Orders all_Orders;
	private static Products all_Products;
	
	public Store() {
		
		customers_list= new LinkedList<Customer>();
		orders_list= new LinkedList<Order>();
		products_list= new LinkedList<Product>();
		reviews_list= new LinkedList<Review>();
		
		
		all_Products= new Products(products_list);
		all_Customers= new Customers(customers_list);
		all_Orders=new Orders(customers_list,orders_list);	
		all_Reviews= new Reviews(reviews_list,products_list,customers_list);

	}
	
	public static void Load_all() {
		all_Products.load_products("C:\\Users\\sondo\\eclipse-workspace\\csc212project11\\prodcuts.csv");
	    all_Customers.loadCustomers("C:\\Users\\sondo\\eclipse-workspace\\csc212project11\\customers.csv");
	    all_Orders.loadOrders("C:\\Users\\sondo\\eclipse-workspace\\csc212project11\\orders.csv");
	    all_Reviews.load_reviews("C:\\Users\\sondo\\eclipse-workspace\\csc212project11\\reviews.csv");
	}

	public static void add_Customer(Customer c) {
	    if (all_Customers != null)
	        all_Customers.addCustomer(c);
	    else
	        System.out.println("Error: Customer list not initialized!");
	}

	public static void add_Product(Product p) {
	    if (all_Products != null)
	    	all_Products.addProduct(p);
	    else
	        System.out.println(" Error: Product list not initialized!");
	}

	public static void add_Order(Order o) {
	    if (all_Orders != null)
	        all_Orders.addOrder(o);
	    else
	        System.out.println("Error: Orders list not initialized!");
	}

	public static void add_Review(Review r) {
	    all_Reviews.addReview(r);
	}

	public void displayTop3Products() {
	    if (products_list.empty()) {
	        System.out.println("No products available.");
	        return;
	    }
	    
	    Product max1 = new Product(-1, "no product", -1, -1);
	    Product max2 = new Product(-1, "no product", -1, -1);
	    Product max3 = new Product(-1, "no product", -1, -1);

	    products_list.findFirst();
	    while (true) {
	        Product cur = products_list.retrieve();

	        if (cur.getAverageRating() > max1.getAverageRating()) {
	            max3 = max2;
	            max2 = max1;
	            max1 = cur;
	        } else if (cur.getAverageRating() > max2.getAverageRating()) {
	            max3 = max2;
	            max2 = cur;
	        } else if (cur.getAverageRating() > max3.getAverageRating()) {
	            max3 = cur;
	        }

	        if (products_list.last()) break;
	        products_list.findNext();
	    }

	    System.out.println("\nâ˜… Top Products by Average Rating:");

	    int rank = 1;
	    if (max1 != null) {
	        System.out.println(rank++ + ". Product ID: " + max1.getProductId()
	            + " | Name:" + max1.getName()
	            + " | Avg Rating: " + String.format("%.2f", max1.getAverageRating()));
	    }

	    if (max2 != null) {
	        System.out.println(rank++ + ". Product ID: " + max2.getProductId()
	            + " | Name:" + max2.getName()
	            + " | Avg Rating: " + String.format("%.2f", max2.getAverageRating()));
	    }

	    if (max3 != null) {
	        System.out.println(rank++ + ". Product ID: " + max3.getProductId()
	            + " | Name:" + max3.getName()
	            + " | Avg Rating: " + String.format("%.2f", max3.getAverageRating()));
	    }

	    System.out.println("------------------------------");
	 
	}
	
	
	

	public void showCommonHighRatedProducts2(int c1, int c2) {
		LinkedList<Product> allProducts= all_Products.get_Products();
		if(allProducts.empty()) {
			System.out.println("NO PRODUCTS FOUND!");
			return;
		}
		System.out.println("===COMMON HIGH RATED PRODUTS (>4)=====");
		
		boolean anyfound=false;
		allProducts.findFirst();
		while(true) {
			Product p= allProducts.retrieve();
			int pid= p.getProductId();
			
			if(p.getAverageRating()>4) {
				boolean found1=false;
				boolean found2=false;
				
				if(!reviews_list.empty()) {
					reviews_list.findFirst();
					while(true){
						Review r= reviews_list.retrieve();
						
						if(r.getProductId()==pid) {
							if(r.getCustomerId()==c1)found1=true;
							if(r.getCustomerId()==c2)found2=true;			
						}
						
						if(reviews_list.last())break;
						reviews_list.findNext();
					}
				}
				
				if(found1&&found2) {
				System.out.println("PRODUCT: "+p.getName()+
						"| ID: "+pid+
						"| AVERAGE RATING: "+p.getAverageRating());
				anyfound=true;
				}
			}
			
			if(allProducts.last())break;
			allProducts.findNext();
			}
		
		if(!anyfound)
			System.out.println(" NO COMMON HIGH-RATED PRODUCTS FOUND");
		
	}
	
	
	public static void displayAllOrders_between2dates(LocalDate d1, LocalDate d2) {
	    if (orders_list.empty()) {
	        System.out.println("No orders found!");
	        return;
	    }

	    System.out.println("OrderID\tCustomerID\tProductIDs\tTotalPrice\tDate\tStatus");
	    System.out.println("----------------------------------------------------------");

	    orders_list.findFirst();

	    while (true) {
	        Order o = orders_list.retrieve();

	        //make sure that the order are between d1 & d2
	        if (o.getOrderDate().compareTo(d1) > 0 && o.getOrderDate().compareTo(d2) < 0) {
	            System.out.println(o.getOrderId());
	            o.display();
	        }

	        if (orders_list.last())
	            break;
	        orders_list.findNext();
	    }

	   
	}
	

	public static void main(String[] args) {
		
		Store s= new Store();
		Scanner input= new Scanner(System.in);
		int choice=0;
		do {
			System.out.println("=============================WELCOME TO OUR STORE============================");

			System.out.println("1.Read data from file.");
			System.out.println("2.Add product.");
			System.out.println("3.Register a new customer.");
			System.out.println("4.Place an order.");
			System.out.println("5.Add a review.");
			System.out.println("6.Extract Reviews from a specific customer for all products.");			
			System.out.println("7.Top 3 products by average rating.");
			System.out.println("8.All orders between two dates.");
			System.out.println("9.Common high rated products.");
			System.out.println("10.Remove Product");
			System.out.println("11.Update Product");
			System.out.println("12.search Product by ID.");
			System.out.println("13.Track out of stock products.");
			System.out.println("14.Display reviews for a specific Product");
			System.out.println("15.Display Customer's order history.");
			System.out.println("16.Cancel an order.");
			System.out.println("17.Update an order status.");
			System.out.println("18.search Order by ID.");
			System.out.println("19.Edit a review.");
			System.out.println("20.Get an Average rating for a product.");
			System.out.println("21.Display All Customers");
			System.out.println("22.Display All Orders");
			System.out.println("23.Display All Products");
			System.out.println("24.Display All Reviews");
			System.out.println("0.Exit ");
			System.out.print("----------------------------------");
			System.out.print("Enter your choice: ");
			choice=input.nextInt();
			

			switch(choice) {
			case 1:
				Load_all();
				break;
			case 2: 
				System.out.println("enter the product's ID: ");
				int pid=input.nextInt();
				input.nextLine();
				System.out.println("enter the product's NAME: ");
				String pname=input.nextLine();
				System.out.println("enter the product's PRICE: ");
				double price=input.nextDouble();
				System.out.println("enter the product's STOCK: ");
				int stock=input.nextInt();
				Product p=new Product(pid,pname,price, stock);
				add_Product(p);
				break;
				
			case 3:
				System.out.println("enter the customer's ID: ");
				int cid=input.nextInt();
				input.nextLine();
				System.out.println("enter the customer's NAME: ");
				String cname=input.nextLine();
				System.out.println("enter the customer's EMAIL: ");
				String email=input.nextLine();
				
				Customer c = new Customer(cid, cname, email);
				add_Customer(c);
				break;

            
			case 4:
				System.out.println("enter the order's ID: ");
				int oid=input.nextInt();
				input.nextLine();
				System.out.println("enter the customer's ID: ");
				int ocid=input.nextInt();
				input.nextLine();
				System.out.println("enter the Product IDs you want (put a ; between the ids): ");
				String prodids=input.nextLine();
				System.out.println("enter the Orders TOTAL PRICE: ");
				double tprice=input.nextDouble();
				input.nextLine();
				System.out.print("Enter date (yyyy-MM-dd): ");
				String dateInput = input.nextLine(); 
				LocalDate date = LocalDate.parse(dateInput);
				System.out.println("enter the order's STATUS: ");
				String status=input.nextLine();
				Order o = new Order(oid, ocid, prodids,
						tprice,date, status);
				add_Order(o);
				break;

            
			case 5: 
				System.out.println("enter the Review's ID: ");
				int rid=input.nextInt();
				input.nextLine();
				System.out.println("enter the Product ID you want make a review on: ");
				int prodid=input.nextInt();
				System.out.println("enter the RATING on the review(1-5): ");
				int rating=input.nextInt();
				System.out.println("enter the customer's ID: ");
				int rcid=input.nextInt();
				input.nextLine();
				System.out.println("enter the review's COMMENT: ");
				String comment=input.nextLine();
				
				Review r = new Review(rid, prodid,
						rating, rcid ,comment);
				add_Review(r);
				break;

            
			case 6:
				System.out.println("Enter customer ID you want all reviews for: ");
				int cIDrvs=input.nextInt();
				all_Customers.searchById(cIDrvs).displayReviews();
				break; 
			
				
				
			case 7:
				s.displayTop3Products() ;
				break;
				
				
				
			case 8: 
				System.out.println("Enter the first date: ");
				input.nextLine();
				String d1=input.nextLine();
				input.nextLine();
				LocalDate date1 = LocalDate.parse(d1);
				System.out.println("Enter the Second date: ");
				String d2=input.nextLine();
				LocalDate date2 = LocalDate.parse(d2);
				
				Store.displayAllOrders_between2dates(date1, date2);
	            break;
				
				
			case 9:
				System.out.print("Enter first customer ID: ");
		    	int c1 = input.nextInt();
		    	System.out.print("Enter second customer ID: ");
		   		int c2 = input.nextInt();
		   		s.showCommonHighRatedProducts2(c1, c2);
		   		break;
				

				
				
			case 10: 
				System.out.println("Enter product ID:");
				 int prid= input.nextInt();
				 all_Products.removeProduct(prid);
				 break;
			
			 
			case 11:System.out.println("Enter product ID you want to update: ");
			int oldID= input.nextInt();
				Product up= all_Products.Search_Product_by_id(oldID);
				System.out.print("Enter new ID: ");
				int newID= input.nextInt();
				up.setProductId(newID);
				break;
				
				
			case 12:
				System.out.println("Enter the product ID you want to search about :");
				int srchprd=input.nextInt();
				all_Products.Search_Product_by_id(srchprd).display();
				break;
			
				 
			
			case 13: 
				all_Products.displayOutOfStock();
				break;
				
				
			case 14:  
				System.out.println("Enter the product ID you want to display reviews for :");
				int previd=input.nextInt();
				Product prod= all_Products.Search_Product_by_id(previd);
				prod.displayReviews();
				break;
				
			
			case 15:
				System.out.println("Enter customer ID you want order history for: ");
				int cIDh=input.nextInt();
				all_Customers.searchById(cIDh).displayOrders();
				break;
			
				
			case 16: 
				System.out.println("Enter Order ID you want to cancel:");
				int OrId= input.nextInt();
				all_Orders.searchOrderById(OrId).setStatus("Cancelled");
				break;
			
			case 17: 
				System.out.println("Enter Order id you want to update status for: ");
				int OSId=input.nextInt();
				input.nextLine();
				System.out.println("Enter updated status: ");
				String sts=input.nextLine();
				all_Orders.searchOrderById(OSId).setStatus(sts);
				break;
			
				
			case 18: 
				System.out.println("Enter the Order ID you want to search about :");
				int srchord=input.nextInt();
				all_Orders.searchOrderById(srchord).display();
				break;
			 
			case 19: 
				System.out.println("Enter Review id you want to update: ");
				int revId=input.nextInt();
				input.nextLine();
				System.out.println("Enter updated rating: ");
				int revRate=input.nextInt();
				input.nextLine();
				all_Reviews.Search_Review_by_id(revId).setRating(revRate);
				System.out.println("Enter updated comment: ");
				String Ucommnet=input.nextLine();
				all_Reviews.Search_Review_by_id(revId).setComment(Ucommnet);
				break;
			
			case 20: 
				System.out.println("Enter product ID to get an average rating for: ");
				int ARId= input.nextInt();
				System.out.println(all_Products.Search_Product_by_id(ARId).getAverageRating());
				break;
			
			case 21: 
				all_Customers.displayAll();
				break;
			
			
			case 22: 
				all_Orders.displayAllOrders();
				break;

			
			case 23: 
				all_Products.displayAllProducts();
				break;
				
			case 24: 
				all_Reviews.displayAllReviews();
				break;
			
				
			default: System.out.println("Wrong Entry!");
            
			}
	
		}while(choice!=0);
		input.close();
		
		
	}}
